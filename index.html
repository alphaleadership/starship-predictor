<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prédiction du prochain lancement du Starship</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        #resultats {
            margin: 20px 0;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }
        .date-item {
            margin: 5px 0;
            padding: 5px;
            border-bottom: 1px solid #eee;
        }
        .graphique-container {
            width: 100%;
            max-width: 800px;
            margin: 20px auto;
            height: 400px;
        }
        canvas {
            width: 100% !important;
            height: 100% !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Prédiction des lancements du Starship</h1>
        <div id="resultats">
            <h2>Dates des lancements</h2>
            <div id="dates-lancements"></div>
            <h2>Prédictions</h2>
            <div id="predictions"></div>
        </div>
        <div class="graphique-container">
            <canvas id="graphique"></canvas>
        </div>
    </div>

    <script>
        // Dates des lancements précédents du Starship
        const datesLancements = [
    '2023-04-20',
    '2023-11-18',
    '2024-03-14',
    '2024-06-06',
    '2024-10-13',
    '2024-11-20',
    '2025-01-17',
    '2025-03-07',
    '2025-05-28',
    
];

        // Convertir les dates en objets Date
        const datesObj = datesLancements.map(date => new Date(date));

        // Calculer les jours depuis le vol précédent
        const joursDepuisPrecedent = datesObj.map((date, index) => {
            if (index === 0) return 1;
            return Math.max(1, Math.floor((date - datesObj[index - 1]) / (1000 * 60 * 60 * 24)));
        });

        // Prendre les derniers points pour la prédiction
        const derniersPoints = 5;
        const derniersJours = joursDepuisPrecedent.slice(-derniersPoints);

        // Fonction pour calculer la régression logarithmique
        function calculerRegressionLogarithmique(jours) {
            if (jours.length === 0) return 30; // Valeur par défaut
            
            const n = jours.length;
            const x = Array.from({length: n}, (_, i) => i + 1);
            const y = jours;
            
            // Calculer les sommes pour la régression
            const sumX = x.reduce((a, b) => a + b, 0);
            const sumY = y.reduce((a, b) => a + b, 0);
            const sumXY = x.reduce((a, b, i) => a + b * y[i], 0);
            const sumX2 = x.reduce((a, b) => a + b * b, 0);
            
            // Calculer les coefficients de la régression
            const a = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
            const b = (sumY - a * sumX) / n;
            
            // Retourner la prédiction pour le prochain point
            return a * (n + 1) + b;
        }

        // Fonction pour calculer l'écart en jours entre deux dates
        function calculerEcartJours(date1, date2) {
            return Math.max(1, Math.floor((date2 - date1) / (1000 * 60 * 60 * 24)));
        }

        // Fonction pour calculer la date prédite pour un vol donné
        function calculerDatePredite(numeroVol, datePrecedente) {
            const prediction = Math.max(1, calculerRegressionLogarithmique(derniersJours));
            return new Date(datePrecedente.getTime() + prediction * 24 * 60 * 60 * 1000);
        }

        // Calculer les prédictions pour les vols passés
        const predictionsPassees = [];
        for (let i = 1; i <= datesLancements.length; i++) {
            const dateReelle = new Date(datesLancements[i - 1]);
            
            // Calculer la prédiction basée sur les vols précédents
            let datePredite;
            if (i <= derniersPoints) {
                // Pas de prédiction pour les premiers vols
                datePredite = dateReelle;
            } else {
                // Pour les vols suivants, utiliser les derniers points disponibles
                const joursPrecedents = joursDepuisPrecedent.slice(0, i - 1).slice(-derniersPoints);
                const datePrecedente = new Date(datesLancements[i - 2]);
                datePredite = calculerDatePredite(i, datePrecedente);
            }
            
            // Calculer l'écart entre la date réelle et la date prédite
            const ecart = calculerEcartJours(datePredite, dateReelle);
            predictionsPassees.push({
                numero: i,
                dateReelle: dateReelle,
                datePredite: datePredite,
                ecart: ecart
            });
        }

        // Prédire les dates futures
        const predictions = [];
        const dernierVol = datesLancements.length;
        const nombreVolsPredits = 3;
        const dernierVolTotal = dernierVol + nombreVolsPredits;

        // Générer les prédictions en mettant à jour la moyenne à chaque fois
        let derniersJoursActuels = [...joursDepuisPrecedent];
        let datesActuelles = [...datesObj];

        for (let i = dernierVol; i < dernierVolTotal; i++) {
            // Calculer la moyenne pondérée avec les derniers points
            const derniersJoursPrediction = derniersJoursActuels.slice(-derniersPoints);
            const moyenneActuelle = calculerRegressionLogarithmique(derniersJoursPrediction);

            // Prédire le prochain vol
            const datePrecedente = i === dernierVol ? 
                datesActuelles[datesActuelles.length - 1] : 
                predictions[predictions.length - 1].date;
            const datePredite = new Date(datePrecedente.getTime() + moyenneActuelle * 24 * 60 * 60 * 1000);
            
            predictions.push({
                numero: i + 1,
                date: datePredite
            });

            // Mettre à jour les tableaux pour la prochaine itération
            const joursDepuisDernier = Math.floor((datePredite - datePrecedente) / (1000 * 60 * 60 * 24));
            derniersJoursActuels.push(joursDepuisDernier);
            datesActuelles.push(datePredite);
        }

        // Fonction pour calculer les points de la courbe de tendance
        function calculerPointsTendance(debut, fin, datePrecedente) {
            const points = [];
            const dateDebut = new Date(datePrecedente);
            const dateFin = new Date(predictions[predictions.length - 1].date);
            const totalJours = Math.ceil((dateFin - dateDebut) / (1000 * 60 * 60 * 24));
            
            // Créer une courbe logarithmique
            for (let i = 0; i <= 100; i++) {
                const progression = i / 100;
                // Utiliser une fonction logarithmique pour la progression
                const logProgression = Math.log(1 + progression * (Math.E - 1)) / Math.log(Math.E);
                const joursDepuisDebut = Math.floor(totalJours * logProgression);
                const datePoint = new Date(dateDebut.getTime() + joursDepuisDebut * 24 * 60 * 60 * 1000);
                const valeurY = debut + (fin - debut) * logProgression;
                
                points.push({
                    x: datePoint,
                    y: valeurY
                });
            }
            
            return points;
        }

        // Fonction pour formater la date en français
        function formaterDate(date) {
            const jours = ['Dimanche', 'Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi'];
            const mois = ['janvier', 'février', 'mars', 'avril', 'mai', 'juin', 'juillet', 'août', 'septembre', 'octobre', 'novembre', 'décembre'];
            const jourSemaine = jours[date.getDay()];
            const jour = date.getDate();
            const moisNom = mois[date.getMonth()];
            const annee = date.getFullYear();
            return `${jourSemaine} ${jour} ${moisNom} ${annee}`;
        }

        // Afficher les résultats dans le DOM
        const datesContainer = document.getElementById('dates-lancements');
        const predictionsContainer = document.getElementById('predictions');

        // Afficher les vols passés avec leurs prédictions
        predictionsPassees.forEach(pred => {
            const div = document.createElement('div');
            div.className = 'date-item';
            let texte = `Vol ${pred.numero}: ${formaterDate(pred.dateReelle)}`;
            
            // Ajouter l'écart avec le vol précédent
            if (pred.numero > 1) {
                const datePrecedente = new Date(datesLancements[pred.numero - 2]);
                const ecartPrecedent = calculerEcartJours(datePrecedente, pred.dateReelle);
                texte += ` (${ecartPrecedent} jours après le vol précédent)`;
            }
            
            // Ajouter la prédiction seulement à partir du 6ème vol
            if (pred.numero > 5) {
                const signeEcart = pred.ecart > 0 ? '+' : '';
                texte += ` [Prédiction: ${formaterDate(pred.datePredite)}, écart: ${signeEcart}${pred.ecart} jours]`;
            }
            
            div.textContent = texte;
            datesContainer.appendChild(div);
        });

        // Afficher les prédictions futures
        predictions.forEach((pred, index) => {
            const div = document.createElement('div');
            div.className = 'date-item';
            let texte = `Vol ${pred.numero}: ${formaterDate(pred.date)}`;
            
            // Ajouter l'écart avec le vol précédent
            const datePrecedente = index === 0 ? 
                new Date(datesLancements[datesLancements.length - 1]) : 
                predictions[index - 1].date;
            const ecartPrecedent = calculerEcartJours(datePrecedente, pred.date);
            texte += ` (${ecartPrecedent} jours après le vol précédent)`;
            
            div.textContent = texte;
            predictionsContainer.appendChild(div);
        });

        // Calculer la moyenne des écarts absolus
        const moyenneEcart = Math.round(
            predictionsPassees.reduce((sum, pred) => sum + Math.abs(pred.ecart), 0) / 
            predictionsPassees.length
        );

        // Ajouter un résumé des écarts
        const divResume = document.createElement('div');
        divResume.className = 'date-item';
        divResume.style.fontWeight = 'bold';
        divResume.textContent = `Moyenne des écarts absolus: ${moyenneEcart} jours`;
        datesContainer.appendChild(divResume);

        // Créer le graphique
        const ctx = document.getElementById('graphique').getContext('2d');
        new Chart(ctx, {
            type: 'scatter',
            data: {
                datasets: [{
                    label: 'Écarts réels entre vols',
                    data: joursDepuisPrecedent.map((jours, index) => ({
                        x: index + 1,
                        y: jours
                    })),
                    backgroundColor: 'blue',
                    showLine: true,
                    borderColor: 'blue',
                    pointRadius: 4
                }, {
                    label: 'Écarts prédits',
                    data: predictions.map((pred, index) => {
                        const datePrecedente = index === 0 ? 
                            datesObj[datesObj.length - 1] : 
                            predictions[index - 1].date;
                        const ecart = Math.floor((pred.date - datePrecedente) / (1000 * 60 * 60 * 24));
                        return {
                            x: pred.numero,
                            y: ecart
                        };
                    }),
                    backgroundColor: 'red',
                    showLine: true,
                    borderColor: 'red',
                    pointRadius: 4
                }, {
                    label: '',
                    data: [{
                        x: dernierVol,
                        y: joursDepuisPrecedent[joursDepuisPrecedent.length - 1]
                    }, {
                        x: dernierVol + 1,
                        y: Math.floor((predictions[0].date - datesObj[datesObj.length - 1]) / (1000 * 60 * 60 * 24))
                    }],
                    backgroundColor: 'rgba(0,255,0,0.5)',
                    showLine: true,
                    borderColor: 'green',
                    pointRadius: 0,
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Numéro du vol'
                        },
                        min: 1,
                        max: dernierVolTotal,
                        ticks: {
                            stepSize: 1
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Jours entre les vols'
                        },
                        min: 0
                    }
                },
                plugins: {
                    title: {
                        display: true,
                        text: `Écarts entre les lancements du Starship jusqu'au ${dernierVolTotal}ème vol`
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `Vol ${context.raw.x}: ${context.raw.y} jours`;
                            }
                        }
                    }
                }
            }
        });
    </script>
</body>
</html> 
