<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prédiction du prochain lancement du Starship</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        #resultats {
            margin: 20px 0;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }
        .date-item {
            margin: 5px 0;
            padding: 5px;
            border-bottom: 1px solid #eee;
        }
        .graphique-container {
            width: 100%;
            max-width: 800px;
            margin: 20px auto;
            height: 400px;
        }
        canvas {
            width: 100% !important;
            height: 100% !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Prédiction des lancements du Starship</h1>
        <div id="resultats">
            <h2>Dates des lancements</h2>
            <div id="dates-lancements"></div>
            <h2>Prédictions</h2>
            <div id="predictions"></div>
        </div>
        <div class="graphique-container">
            <canvas id="graphique"></canvas>
        </div>
    </div>

    <script>
        // Dates des lancements précédents du Starship
        const datesLancements = [
    '2023-04-20',
    '2023-11-18',
    '2024-03-14',
    '2024-06-06',
    '2024-10-13',
    '2024-11-20',
    '2025-01-17',
    '2025-03-07',
    '2025-05-28',
    
];

        // Convertir les dates en objets Date
        const datesObj = datesLancements.map(date => new Date(date));

        // Calculer les jours depuis le vol précédent
        const joursDepuisPrecedent = datesObj.map((date, index) => {
            if (index === 0) return 1;
            return Math.max(1, Math.floor((date - datesObj[index - 1]) / (1000 * 60 * 60 * 24)));
        });

        // Prendre les derniers points pour la prédiction
        const derniersPoints = 5;
        const derniersJours = joursDepuisPrecedent.slice(-derniersPoints);

        // Fonction pour calculer la moyenne pondérée des derniers écarts
        function calculerMoyennePonderee(jours) {
            if (jours.length === 0) return 30; // Valeur par défaut
            
            // Donner plus de poids aux écarts récents
            const poids = jours.map((_, index) => Math.abs(jours[index] - (index > 0 ? jours[index - 1] : jours[0])));
            const sommePoids = poids.reduce((a, b) => a + b, 0);
            
            return jours.reduce((acc, jour, index) => {
                return acc + (jour * poids[index] / sommePoids);
            }, 0);
        }

        // Fonction pour calculer la date prédite pour un vol donné
        function calculerDatePredite(numeroVol, datePrecedente) {
            const moyennePonderee = calculerMoyennePonderee(derniersJours);
            return new Date(datePrecedente.getTime() + moyennePonderee * 24 * 60 * 60 * 1000);
        }

        // Calculer les prédictions pour les vols passés
        const predictionsPassees = [];
        for (let i = 1; i <= datesLancements.length; i++) {
            const dateReelle = new Date(datesLancements[i - 1]);
            
            // Calculer la prédiction basée sur les vols précédents
            let datePredite;
            if (i <= derniersPoints) {
                // Pas de prédiction pour les premiers vols
                datePredite = dateReelle;
            } else {
                // Pour les vols suivants, utiliser les derniers points disponibles
                const joursPrecedents = joursDepuisPrecedent.slice(0, i - 1).slice(-derniersPoints);
                const datePrecedente = new Date(datesLancements[i - 2]);
                datePredite = calculerDatePredite(i, datePrecedente);
            }
            
            // Calculer l'écart entre la date réelle et la date prédite
            const ecart = calculerEcartJours(datePredite, dateReelle);
            predictionsPassees.push({
                numero: i,
                dateReelle: dateReelle,
                datePredite: datePredite,
                ecart: ecart
            });
        }

        // Prédire les dates futures
        const predictions = [];
        const dernierVol = datesLancements.length;
        const nombreVolsPredits = 1;
        const dernierVolTotal = dernierVol + nombreVolsPredits;

        // Générer les prédictions en mettant à jour la moyenne à chaque fois
        let derniersJoursActuels = [...joursDepuisPrecedent];

        for (let i = dernierVol; i < dernierVolTotal; i++) {
            // Calculer la moyenne pondérée avec les derniers points
            const derniersJoursPrediction = derniersJoursActuels.slice(-derniersPoints);
            const moyenneActuelle = calculerMoyennePonderee(derniersJoursPrediction);

            // Prédire le prochain vol
            const datePrecedente = i === dernierVol ? 
                new Date(datesLancements[datesLancements.length - 1]) : 
                predictions[predictions.length - 1].date;
            const datePredite = new Date(datePrecedente.getTime() + moyenneActuelle * 24 * 60 * 60 * 1000);
            
            predictions.push({
                numero: i + 1,
                date: datePredite
            });

            // Mettre à jour les tableaux pour la prochaine itération
            const joursDepuisDernier = Math.floor((datePredite - datePrecedente) / (1000 * 60 * 60 * 24));
            derniersJoursActuels.push(joursDepuisDernier);
        }

        // Fonction pour calculer les points de la courbe de tendance
        function calculerPointsTendance(debut, fin, datePrecedente) {
            const points = [];
            const pas = (fin - debut) / 100; // 100 points pour une courbe fluide
            const moyennePonderee = calculerMoyennePonderee(derniersJours);
            
            // Commencer exactement au point précédent
            points.push({
                x: datePrecedente,
                y: debut
            });
            
            // Ajouter les points intermédiaires
            for (let x = debut + pas; x <= fin; x += pas) {
                points.push({
                    x: new Date(datePrecedente.getTime() + moyennePonderee * 24 * 60 * 60 * 1000),
                    y: x
                });
            }
            return points;
        }

        // Fonction pour formater la date en français
        function formaterDate(date) {
            const jours = ['Dimanche', 'Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi'];
            const mois = ['janvier', 'février', 'mars', 'avril', 'mai', 'juin', 'juillet', 'août', 'septembre', 'octobre', 'novembre', 'décembre'];
            const jourSemaine = jours[date.getDay()];
            const jour = date.getDate();
            const moisNom = mois[date.getMonth()];
            const annee = date.getFullYear();
            return `${jourSemaine} ${jour} ${moisNom} ${annee}`;
        }

        // Fonction pour calculer l'écart en jours entre deux dates
        function calculerEcartJours(date1, date2) {
            return Math.floor((date2 - date1) / (1000 * 60 * 60 * 24));
        }

        // Afficher les résultats dans le DOM
        const datesContainer = document.getElementById('dates-lancements');
        const predictionsContainer = document.getElementById('predictions');

        // Afficher les vols passés avec leurs prédictions
        predictionsPassees.forEach(pred => {
            const div = document.createElement('div');
            div.className = 'date-item';
            let texte = `Vol ${pred.numero}: ${formaterDate(pred.dateReelle)}`;
            
            // Ajouter l'écart avec le vol précédent
            if (pred.numero > 1) {
                const datePrecedente = new Date(datesLancements[pred.numero - 2]);
                const ecartPrecedent = calculerEcartJours(datePrecedente, pred.dateReelle);
                texte += ` (${ecartPrecedent} jours après le vol précédent)`;
            }
            
            // Ajouter l'écart avec la prédiction seulement à partir du troisième vol
            if (pred.numero > derniersPoints) {
                const signeEcart = pred.ecart > 0 ? '+' : '';
                texte += ` [Prédiction: ${formaterDate(pred.datePredite)}, écart: ${signeEcart}${pred.ecart} jours]`;
            }
            
            div.textContent = texte;
            datesContainer.appendChild(div);
        });

        // Afficher les prédictions futures
        predictions.forEach((pred, index) => {
            const div = document.createElement('div');
            div.className = 'date-item';
            let texte = `Vol ${pred.numero}: ${formaterDate(pred.date)}`;
            
            // Ajouter l'écart avec le vol précédent
            const datePrecedente = index === 0 ? 
                new Date(datesLancements[datesLancements.length - 1]) : 
                predictions[index - 1].date;
            const ecartPrecedent = calculerEcartJours(datePrecedente, pred.date);
            texte += ` (${ecartPrecedent} jours après le vol précédent)`;
            
            div.textContent = texte;
            predictionsContainer.appendChild(div);
        });

        // Calculer la moyenne des écarts absolus
        const moyenneEcart = Math.round(
            predictionsPassees.reduce((sum, pred) => sum + Math.abs(pred.ecart), 0) / 
            predictionsPassees.length
        );

        // Ajouter un résumé des écarts
        const divResume = document.createElement('div');
        divResume.className = 'date-item';
        divResume.style.fontWeight = 'bold';
        divResume.textContent = `Moyenne des écarts absolus: ${moyenneEcart} jours`;
        datesContainer.appendChild(divResume);

        // Créer le graphique
        const ctx = document.getElementById('graphique').getContext('2d');
        new Chart(ctx, {
            type: 'scatter',
            data: {
                datasets: [{
                    label: 'Lancements réels',
                    data: datesObj.map((date, index) => ({
                        x: date,
                        y: index + 1
                    })),
                    backgroundColor: 'blue'
                }, {
                    label: 'Prédictions',
                    data: predictions.map(pred => ({
                        x: pred.date,
                        y: pred.numero
                    })),
                    backgroundColor: 'red'
                }, {
                    label: 'Courbe de tendance',
                    data: calculerPointsTendance(
                        joursDepuisPrecedent[0],
                        joursDepuisPrecedent[joursDepuisPrecedent.length - 1],
                        datesObj[0]
                    ),
                    type: 'line',
                    borderColor: 'green',
                    borderWidth: 2,
                    pointRadius: 0,
                    fill: false
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        type: 'time',
                        time: {
                            unit: 'month',
                            displayFormats: {
                                month: 'MMM yyyy'
                            }
                        },
                        title: {
                            display: true,
                            text: 'Date'
                        },
                        min: datesObj[0],
                        max: predictions[predictions.length - 1].date
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Numéro du vol'
                        },
                        min: 1,
                        max: dernierVolTotal,
                        ticks: {
                            stepSize: 1
                        }
                    }
                },
                plugins: {
                    title: {
                        display: true,
                        text: `Prédiction des lancements du Starship jusqu'au ${dernierVolTotal}ème vol`
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const date = new Date(context.raw.x);
                                return `Vol ${context.raw.y}: ${formaterDate(date)}`;
                            }
                        }
                    }
                }
            }
        });
    </script>
</body>
</html> 
